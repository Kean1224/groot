(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[820],{3945:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var l=s(5155),a=s(2115),r=s(5695);function n(){let e=(0,r.useParams)(),t=null==e?void 0:e.auctionId,[s,n]=(0,a.useState)(null),[o,i]=(0,a.useState)(null),[d,c]=(0,a.useState)(!1),[u,x]=(0,a.useState)("Auction Title"),[h,m]=(0,a.useState)(Date.now()+36e5),[p]=(0,a.useState)(Date.now()),[b,g]=(0,a.useState)("not_paid"),[f,j]=(0,a.useState)(!1),[y]=(0,a.useState)(!1),[w,v]=(0,a.useState)([]),[N,S]=(0,a.useState)(!1),[C,P]=(0,a.useState)([]),[k,A]=(0,a.useState)(!1),R=()=>{S(!0),fetch("/api/fica").then(e=>e.json()).then(e=>v(e||[])).finally(()=>S(!1))},D=()=>{A(!0),fetch("/api/pending-users").then(e=>e.json()).then(e=>P(e||[])).finally(()=>A(!1))};(0,a.useEffect)(()=>{y&&(R(),D())},[y]);let I=async e=>{await fetch("/api/fica/".concat(e,"/approve"),{method:"POST"}),v(t=>t.map(t=>t.email===e?{...t,status:"approved"}:t))},_=async e=>{await fetch("/api/fica/".concat(e,"/reject"),{method:"POST"}),v(t=>t.map(t=>t.email===e?{...t,status:"rejected"}:t))},B=async e=>{await fetch("/api/pending-users/".concat(e,"/approve"),{method:"POST"}),P(t=>t.filter(t=>t.email!==e))},E=async e=>{await fetch("/api/pending-users/".concat(e,"/reject"),{method:"POST"}),P(t=>t.filter(t=>t.email!==e))},[F,T]=(0,a.useState)([]),[O]=(0,a.useState)("user@example.com"),[U,Y]=(0,a.useState)("not_uploaded"),[q,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&O&&(null==s||!s.depositRequired)&&fetch("/api/fica/".concat(O)).then(e=>e.json()).then(e=>Y(e.status||"not_uploaded"))},[t,O,s]);let M=async e=>{if(!e.target.files||!e.target.files[0])return;L(!0);let t=new FormData;t.append("file",e.target.files[0]),await fetch("/api/fica/".concat(O),{method:"POST",body:t}),L(!1),Y("pending"),alert("FICA document uploaded. Awaiting admin approval.")},[H]=(0,a.useState)([]),[J]=(0,a.useState)([]),[V,z]=(0,a.useState)(""),[G,K]=(0,a.useState)(""),[Q,W]=(0,a.useState)(9),[X,Z]=(0,a.useState)(1);(0,a.useEffect)(()=>{t&&fetch("".concat("http://localhost:5000/api","/auctions")).then(e=>e.json()).then(e=>{let s=e.find(e=>e.id===t);s&&(n(s),x(s.title),m(new Date(s.endTime).getTime()))})},[t]),(0,a.useEffect)(()=>{t&&O&&fetch("/api/auctions/".concat(t,"/is-registered?email=").concat(encodeURIComponent(O))).then(e=>e.json()).then(e=>i(!!e.registered)).catch(()=>i(!1))},[t,O]);let $=async()=>{c(!0);try{(await fetch("/api/auctions/".concat(t,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:O})})).ok?(i(!0),alert("You have successfully registered!")):alert("Registration failed.")}catch(e){alert("Registration failed.")}c(!1)};(0,a.useEffect)(()=>{t&&O&&fetch("/api/deposits/".concat(t,"/").concat(O)).then(e=>e.json()).then(e=>g(e.status||"not_paid"))},[t,O]),(0,a.useEffect)(()=>{if(!t)return;let e=async()=>{try{let e=await fetch("".concat("http://localhost:5000/api","/auctions/").concat(t,"/lots"));if(e.ok){let t=await e.json();T(t.lots||[])}}catch(e){}};e();let s=setInterval(e,3e3);return()=>clearInterval(s)},[t]);let ee=async()=>{t&&O&&(j(!0),await fetch("/api/deposits/".concat(t,"/").concat(O),{method:"POST"}),j(!1),g("pending"),alert("Please pay the deposit to the provided banking details. Your payment will be reviewed by admin."))},et=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]},es=e=>{},el=(e,t,s)=>{};return(0,l.jsx)("main",{className:"min-h-screen px-2 py-10 sm:px-6 bg-gradient-to-br from-yellow-200 via-white to-blue-200 flex justify-center items-start",children:(0,l.jsxs)("div",{className:"w-full max-w-5xl bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl border border-yellow-200 p-0 sm:p-0 flex flex-col items-center relative overflow-hidden",children:[(0,l.jsxs)("div",{className:"w-full bg-gradient-to-r from-yellow-300/60 via-white/80 to-blue-200/60 py-8 px-6 flex flex-col items-center border-b border-yellow-100 relative",children:[(0,l.jsx)("div",{className:"w-20 h-20 mb-4 rounded-full bg-gradient-to-tr from-yellow-400 via-yellow-100 to-blue-200 flex items-center justify-center shadow-lg border-4 border-white",children:(0,l.jsx)("span",{className:"text-5xl",children:"\uD83C\uDFC6"})}),(0,l.jsx)("h1",{className:"text-4xl sm:text-5xl font-extrabold text-yellow-600 mb-2 text-center drop-shadow-lg tracking-tight",children:u}),(0,l.jsxs)("div",{className:"w-full flex flex-col sm:flex-row justify-center items-center gap-4 mt-2",children:[!1===o&&(0,l.jsx)("button",{className:"bg-green-600 hover:bg-green-700 text-white font-bold px-6 py-2 rounded-xl shadow-lg transition-all duration-150 focus:ring-2 focus:ring-green-300 focus:outline-none mb-2",onClick:$,disabled:d,children:d?"Registering...":"Register Here"}),!0===o&&(0,l.jsx)("span",{className:"bg-green-100 text-green-700 px-6 py-2 rounded-xl shadow font-bold border border-green-200 mb-2",children:"You have successfully registered!"}),(0,l.jsxs)("div",{className:"bg-blue-100 text-blue-800 font-mono px-6 py-2 rounded-xl shadow border border-blue-200 text-lg",children:["Auction ends in: ",function(e){if(e<=0)return"Ended";let t=Math.floor(e/1e3),s=Math.floor(t/3600),l=Math.floor(t%3600/60),a=t%60;return s>0?"".concat(s,":").concat(l.toString().padStart(2,"0"),":").concat(a.toString().padStart(2,"0")):"".concat(l,":").concat(a.toString().padStart(2,"0"))}(h-p)]}),(null==s?void 0:s.depositRequired)&&(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsxs)("span",{className:"text-red-600 font-semibold mb-1",children:["Deposit Required: R",s.depositAmount]}),"not_paid"===b&&(0,l.jsx)("button",{onClick:ee,className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold px-6 py-2 rounded-xl shadow-lg transition-all duration-150 focus:ring-2 focus:ring-yellow-300 focus:outline-none",disabled:f,children:f?"Processing...":"Pay Deposit"}),"pending"===b&&(0,l.jsx)("span",{className:"bg-yellow-100 text-yellow-700 px-6 py-2 rounded-xl shadow font-bold border border-yellow-200",children:"Deposit Pending Approval"}),"approved"===b&&(0,l.jsx)("span",{className:"bg-blue-100 text-blue-700 px-6 py-2 rounded-xl shadow font-bold border border-blue-200",children:"Deposit Approved"}),"approved"!==b&&(0,l.jsxs)("div",{className:"mt-2 text-xs text-gray-700 bg-white/80 p-2 rounded border border-yellow-200",children:[(0,l.jsx)("div",{className:"font-bold mb-1",children:"Banking Details:"}),(0,l.jsx)("div",{children:"Bank: [Your Bank Name]"}),(0,l.jsx)("div",{children:"Account: [Your Account Number]"}),(0,l.jsxs)("div",{children:["Reference: ",O," / ",u]})]})]})]})]}),(0,l.jsxs)("div",{className:"w-full flex flex-col sm:flex-row justify-end items-center gap-4 px-6 py-6 border-b border-yellow-100 bg-white/70",children:[(0,l.jsx)("button",{onClick:()=>et(void 0,"buyer"),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold px-6 py-2 rounded-xl shadow-lg transition-all duration-150 focus:ring-2 focus:ring-blue-300 focus:outline-none",children:"Download My Buyer Invoice (PDF)"}),y&&(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 items-center",children:[(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)("label",{className:"font-semibold text-sm",children:"Buyer:"}),(0,l.jsxs)("select",{className:"border rounded-xl px-2 py-1 text-sm focus:ring-2 focus:ring-blue-200",value:V,onChange:e=>z(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select buyer..."}),H.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsx)("button",{onClick:()=>V&&et(V,"buyer"),className:"bg-blue-600 hover:bg-blue-700 text-white font-bold px-4 py-2 rounded-xl shadow disabled:opacity-50 transition-all duration-150",disabled:!V,children:"Download Buyer Invoice"})]}),(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)("label",{className:"font-semibold text-sm",children:"Seller:"}),(0,l.jsxs)("select",{className:"border rounded-xl px-2 py-1 text-sm focus:ring-2 focus:ring-green-200",value:G,onChange:e=>K(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select seller..."}),J.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsx)("button",{onClick:()=>G&&et(G,"seller"),className:"bg-green-600 hover:bg-green-700 text-white font-bold px-4 py-2 rounded-xl shadow disabled:opacity-50 transition-all duration-150",disabled:!G,children:"Download Seller Invoice"})]})]})]}),(0,l.jsx)("div",{className:"w-full border-t border-dashed border-yellow-200 my-8"}),y&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"w-full px-6 py-6 bg-white/80 rounded-xl mb-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-bold text-yellow-700",children:"FICA Approvals"}),(0,l.jsx)("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm",onClick:R,disabled:N,children:N?"Refreshing...":"Refresh"})]}),N?(0,l.jsx)("div",{className:"text-gray-500",children:"Loading..."}):0===w.length?(0,l.jsx)("div",{className:"text-gray-400 italic",children:"No FICA uploads found."}):(0,l.jsxs)("table",{className:"w-full text-sm border mb-8",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-yellow-100",children:[(0,l.jsx)("th",{className:"p-2 border",children:"User Email"}),(0,l.jsx)("th",{className:"p-2 border",children:"Status"}),(0,l.jsx)("th",{className:"p-2 border",children:"Document"}),(0,l.jsx)("th",{className:"p-2 border",children:"Actions"})]})}),(0,l.jsx)("tbody",{children:w.map(e=>(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("td",{className:"p-2 border",children:e.email}),(0,l.jsx)("td",{className:"p-2 border",children:e.status}),(0,l.jsx)("td",{className:"p-2 border",children:(0,l.jsx)("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"View"})}),(0,l.jsxs)("td",{className:"p-2 border flex gap-2",children:[(0,l.jsx)("button",{className:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded",onClick:()=>I(e.email),disabled:"approved"===e.status,children:"Approve"}),(0,l.jsx)("button",{className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded",onClick:()=>_(e.email),disabled:"rejected"===e.status,children:"Reject"})]})]},e.email))})]})]}),(0,l.jsxs)("div",{className:"w-full px-6 py-6 bg-white/80 rounded-xl mb-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h2",{className:"text-lg font-bold text-blue-700",children:"User Registration Approvals"}),(0,l.jsx)("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm",onClick:D,disabled:k,children:k?"Refreshing...":"Refresh"})]}),k?(0,l.jsx)("div",{className:"text-gray-500",children:"Loading..."}):0===C.length?(0,l.jsx)("div",{className:"text-gray-400 italic",children:"No pending user registrations."}):(0,l.jsxs)("table",{className:"w-full text-sm border",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"bg-blue-100",children:[(0,l.jsx)("th",{className:"p-2 border",children:"User Email"}),(0,l.jsx)("th",{className:"p-2 border",children:"Name"}),(0,l.jsx)("th",{className:"p-2 border",children:"Registered At"}),(0,l.jsx)("th",{className:"p-2 border",children:"Actions"})]})}),(0,l.jsx)("tbody",{children:C.map(e=>(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("td",{className:"p-2 border",children:e.email}),(0,l.jsx)("td",{className:"p-2 border",children:e.name||"-"}),(0,l.jsx)("td",{className:"p-2 border",children:e.registeredAt?new Date(e.registeredAt).toLocaleString():"-"}),(0,l.jsxs)("td",{className:"p-2 border flex gap-2",children:[(0,l.jsx)("button",{className:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded",onClick:()=>B(e.email),children:"Approve"}),(0,l.jsx)("button",{className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded",onClick:()=>E(e.email),children:"Reject"})]})]},e.email))})]})]})]}),(0,l.jsxs)("div",{className:"w-full flex justify-end mb-6 items-center gap-2 px-6",children:[(0,l.jsx)("label",{className:"text-sm",children:"Lots per page:"}),(0,l.jsxs)("select",{className:"border rounded-xl px-2 py-1 text-sm focus:ring-2 focus:ring-yellow-200",value:Q,onChange:e=>W(Number(e.target.value)),children:[(0,l.jsx)("option",{value:9,children:"9"}),(0,l.jsx)("option",{value:18,children:"18"}),(0,l.jsx)("option",{value:36,children:"36"})]})]}),(0,l.jsx)("div",{className:"w-full px-6 pb-8",children:0===F.length?(0,l.jsx)("p",{className:"text-center text-gray-400 italic",children:"No lots found."}):(0,l.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:F.map(e=>(0,l.jsxs)("div",{className:"bg-white/90 rounded-2xl shadow-lg border border-yellow-100 p-6 hover:shadow-2xl transition-all duration-150 flex flex-col items-center text-center",children:[(0,l.jsx)("img",{src:e.imageUrl||"/placeholder.jpg",alt:e.title,className:"w-full h-40 object-cover rounded-xl mb-4"}),(0,l.jsx)("h2",{className:"text-xl font-bold text-yellow-700 mb-2",children:e.title}),(0,l.jsx)("p",{className:"text-gray-600 mb-2",children:e.description}),(0,l.jsxs)("span",{className:"text-lg font-semibold text-blue-700 mb-2",children:["Current Bid: R",e.currentBid]}),(null==s?void 0:s.depositRequired)?"approved"===b?(0,l.jsx)("button",{className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold px-4 py-2 rounded-lg shadow transition-all duration-150",onClick:()=>el(e.id,e.currentBid,e.bidIncrement||0),children:"Place Bid"}):(0,l.jsx)("span",{className:"text-xs text-red-500 font-semibold",children:"You must pay and have your deposit approved to bid."}):(0,l.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,l.jsx)("span",{className:"text-xs text-blue-600 font-semibold",children:"FICA required to bid."}),"not_uploaded"===U&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("input",{type:"file",accept:"image/*,.pdf",onChange:M,disabled:q,className:"text-xs"}),(0,l.jsx)("span",{className:"text-xs text-gray-500",children:"Upload ID/Proof of Address"})]}),"pending"===U&&(0,l.jsx)("span",{className:"text-xs text-yellow-600",children:"FICA pending admin approval."}),"approved"===U&&(0,l.jsx)("button",{className:"bg-yellow-500 hover:bg-yellow-600 text-white font-bold px-4 py-2 rounded-lg shadow transition-all duration-150",onClick:()=>el(e.id,e.currentBid,e.bidIncrement||0),children:"Place Bid"}),"rejected"===U&&(0,l.jsx)("span",{className:"text-xs text-red-600",children:"FICA rejected. Please re-upload."})]})]},e.id))})}),(0,l.jsxs)("div",{className:"w-full mt-4 flex justify-center items-center gap-6 pb-8",children:[(0,l.jsx)("button",{onClick:()=>es("prev"),disabled:1===X,className:"px-5 py-2 rounded-xl bg-gray-100 hover:bg-yellow-100 text-gray-700 font-semibold shadow disabled:opacity-50 transition-all duration-150",children:"← Prev"}),(0,l.jsxs)("span",{className:"text-base font-medium",children:["Page ",X," of ",1]}),(0,l.jsx)("button",{onClick:()=>es("next"),disabled:1===X,className:"px-5 py-2 rounded-xl bg-gray-100 hover:bg-yellow-100 text-gray-700 font-semibold shadow disabled:opacity-50 transition-all duration-150",children:"Next →"})]}),(0,l.jsx)("div",{className:"absolute -bottom-8 left-1/2 -translate-x-1/2 w-48 h-6 bg-gradient-to-r from-yellow-300 via-yellow-100 to-blue-200 rounded-full blur-md opacity-60"})]})})}},5695:(e,t,s)=>{"use strict";var l=s(8999);s.o(l,"useParams")&&s.d(t,{useParams:function(){return l.useParams}}),s.o(l,"usePathname")&&s.d(t,{usePathname:function(){return l.usePathname}}),s.o(l,"useRouter")&&s.d(t,{useRouter:function(){return l.useRouter}}),s.o(l,"useSearchParams")&&s.d(t,{useSearchParams:function(){return l.useSearchParams}})},9023:(e,t,s)=>{Promise.resolve().then(s.bind(s,3945))}},e=>{e.O(0,[441,964,358],()=>e(e.s=9023)),_N_E=e.O()}]);